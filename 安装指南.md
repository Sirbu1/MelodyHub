# Melody Hub 项目安装指南

## 一、环境要求

在开始安装之前，请确保您的系统已安装以下软件：

- **Java**: JDK 17 或更高版本
- **Node.js**: 18.12.0 或更高版本
- **包管理器**: pnpm 7 或更高版本
- **MySQL**: 8.0 或更高版本
- **Redis**: 5.0 或更高版本
- **MinIO**: 用于对象存储（音频文件和图片）
- **Maven**: 3.6 或更高版本（用于后端编译）

## 二、克隆仓库

```bash
git clone https://github.com/Sirbu1/MelodyHub.git
cd MusicPlayer
```

> **注意**：如果仓库名称不同，请根据实际情况调整。

## 三、后端服务（vibe-music-server）安装与启动

### 1. 数据库初始化

#### 1.1 创建数据库

进入 MySQL 客户端，创建数据库：

```sql
CREATE DATABASE IF NOT EXISTS vibe_music DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 1.2 导入初始数据

执行仓库中 `vibe-music-server/sql/vibe_music.sql` 脚本，导入初始数据：

**方式1：MySQL 客户端执行**

```bash
mysql -u root -p vibe_music < vibe-music-server/sql/vibe_music.sql
```

**方式2：数据库管理工具（如 Navicat、DBeaver）手动导入**

1. 打开数据库管理工具
2. 连接到 MySQL 服务器
3. 选择 `vibe_music` 数据库
4. 执行 `vibe-music-server/sql/vibe_music.sql` 文件

#### 1.3 执行数据库迁移脚本（可选）

如果需要使用论坛、接单等新功能，可能需要执行额外的迁移脚本：

```bash
# 进入 SQL 目录
cd vibe-music-server/sql

# 执行论坛相关表创建（如果未包含在 vibe_music.sql 中）
mysql -u root -p vibe_music < forum_tables.sql

# 执行其他迁移脚本（根据需要）
mysql -u root -p vibe_music < create_forum_order_table.sql
mysql -u root -p vibe_music < add_original_song_fields.sql
# ... 其他迁移脚本
```

### 2. Redis 服务启动

确保 Redis 服务已启动：

**Windows:**
```bash
# 如果使用 Redis for Windows
redis-server
```

**Linux/Mac:**
```bash
# 启动 Redis 服务
redis-server

# 或使用 systemd
sudo systemctl start redis
```

**验证 Redis 连接:**
```bash
redis-cli ping
# 应该返回 PONG
```

### 3. MinIO 服务启动

#### 3.1 下载并安装 MinIO

访问 [MinIO 官网](https://min.io/download) 下载对应系统的 MinIO。

**Windows:**
```bash
# 下载后解压，运行
minio.exe server D:\minio-data
```

**Linux/Mac:**
```bash
# 下载后赋予执行权限
chmod +x minio
./minio server /path/to/minio-data
```

#### 3.2 创建 Bucket

1. 访问 MinIO 控制台（默认地址：http://localhost:9001）
2. 使用默认账号密码登录（minioadmin / minioadmin）
3. 创建名为 `vibe-music-data` 的 Bucket
4. 设置 Bucket 访问策略为 Public（如果需要公开访问）

### 4. 配置修改

进入 `vibe-music-server/src/main/resources`，修改 `application.yml`：

#### 4.1 配置 MySQL 连接

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/vibe_music?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root  # 你的 MySQL 用户名
    password: your_password  # 你的 MySQL 密码
```

#### 4.2 配置 Redis 连接

```yaml
spring:
  data:
    redis:
      host: 127.0.0.1  # Redis 地址
      port: 6379       # Redis 端口
      password:        # Redis 密码（无则留空）
      database: 1      # Redis 数据库编号
```

#### 4.3 配置 MinIO 连接

```yaml
minio:
  endpoint: http://127.0.0.1:9000  # MinIO 端点
  accessKey: minioadmin           # MinIO Access Key
  secretKey: minioadmin           # MinIO Secret Key
  bucket: vibe-music-data         # Bucket 名称
```

#### 4.4 配置邮件服务（可选）

如果需要使用邮件验证码功能，需要配置邮件服务：

```yaml
spring:
  mail:
    host: smtp.163.com                    # SMTP 服务器地址
    username: your_email@163.com          # 你的邮箱账号
    password: your_email_auth_code        # 邮箱授权码（不是登录密码）
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          ssl:
            enable: true
            trust: smtp.163.com
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
```

> **注意**：163 邮箱需要开启 SMTP 服务并获取授权码。其他邮箱服务商配置类似。

### 5. 编译与启动

#### 方式1：Maven 编译启动

```bash
cd vibe-music-server

# 编译项目（跳过测试）
mvn clean package -DskipTests

# 启动 jar 包
java -jar target/vibe-music-server-0.0.1-SNAPSHOT.jar
```

#### 方式2：IDE 直接启动

1. 用 IntelliJ IDEA 或 Eclipse 打开 `vibe-music-server` 目录
2. 等待 Maven 依赖加载完成
3. 运行 `src/main/java/cn/edu/seig/vibemusic/VibeMusicServerApplication.java` 启动类

#### 方式3：使用 Maven Wrapper（推荐）

```bash
cd vibe-music-server

# Windows
mvnw.cmd clean package -DskipTests
java -jar target/vibe-music-server-0.0.1-SNAPSHOT.jar

# Linux/Mac
./mvnw clean package -DskipTests
java -jar target/vibe-music-server-0.0.1-SNAPSHOT.jar
```

### 6. 验证后端服务

启动成功后，访问以下地址验证：

- **健康检查**: http://localhost:8080/actuator/health（如果启用了 Actuator）
- **API 文档**: http://localhost:8080/swagger-ui.html（如果配置了 Swagger）

后端服务默认运行在 **8080** 端口。

---

## 四、前端管理端（vibe-music-admin）安装与启动

### 1. 安装依赖

```bash
# 回到项目根目录
cd ..

# 进入管理端目录
cd vibe-music-admin

# 安装依赖（使用 pnpm）
pnpm install
```

> **注意**：如果未安装 pnpm，可以使用以下命令安装：
> ```bash
> npm install -g pnpm
> ```

### 2. 配置修改

#### 2.1 修改后端接口地址

如果后端服务端口或地址修改，需要调整前端接口配置：

**方式1：修改代理配置**

编辑 `vibe-music-admin/vite.config.ts`，修改代理目标：

```typescript
proxy: {
  "/api": {
    target: "http://localhost:8080",  // 修改为实际的后端地址
    changeOrigin: true,
    rewrite: path => path.replace(/^\/api/, "")
  }
}
```

**方式2：使用环境变量（推荐）**

创建 `.env.development` 文件（如果不存在）：

```bash
# 在 vibe-music-admin 目录下创建
VITE_PORT=8089
VITE_PROXY=[["/api","http://localhost:8080"]]
```

### 3. 启动开发服务

```bash
pnpm run dev
```

启动成功后，访问 **http://localhost:8089**

> **默认端口**: 8089（可在 `.env.development` 中修改 `VITE_PORT`）

### 4. 默认管理员账号

首次启动后，可以使用以下默认账号登录（如果数据库已导入初始数据）：

- **用户名**: admin（或其他在数据库中配置的管理员账号）
- **密码**: 查看数据库 `tb_admin` 表或联系项目维护者

---

## 五、前端客户端（vibe-music-client）安装与启动

### 1. 安装依赖

```bash
# 回到项目根目录
cd ..

# 进入客户端目录
cd vibe-music-client

# 安装依赖
pnpm install
```

### 2. 配置修改

#### 2.1 修改后端接口地址

编辑 `vibe-music-client/src/utils/http.ts`，修改 `baseURL`：

```typescript
const instance: AxiosInstance = axios.create({
  baseURL: 'http://localhost:8080',  // 修改为实际的后端地址
  timeout: 20000,
  // ...
})
```

或者使用环境变量（如果配置了）：

创建 `.env.development` 文件：

```bash
VITE_API_BASE_URL=http://localhost:8080
```

然后在代码中使用：

```typescript
baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080'
```

### 3. 启动开发服务

```bash
pnpm run dev
```

启动成功后，访问 **http://localhost:8090**

> **默认端口**: 8090（可在 `vite.config.ts` 中修改）

---

## 六、一键启动脚本（可选）

项目根目录提供了启动脚本，可以快速启动所有服务：

### Windows

```bash
# 启动所有服务
start-all.bat

# 或使用 PowerShell
.\start-all.ps1
```

### Linux/Mac

```bash
# 需要自行创建启动脚本
# 或分别启动各个服务
```

---

## 七、常见问题排查

### 1. 后端启动失败

**问题**: 端口被占用
```bash
# Windows 查看端口占用
netstat -ano | findstr :8080

# Linux/Mac 查看端口占用
lsof -i :8080

# 杀死占用进程或修改 application.yml 中的端口
```

**问题**: 数据库连接失败
- 检查 MySQL 服务是否启动
- 检查 `application.yml` 中的数据库配置是否正确
- 检查数据库用户权限

**问题**: Redis 连接失败
- 检查 Redis 服务是否启动
- 检查 `application.yml` 中的 Redis 配置
- 使用 `redis-cli ping` 测试连接

**问题**: MinIO 连接失败
- 检查 MinIO 服务是否启动（默认端口 9000）
- 检查 `application.yml` 中的 MinIO 配置
- 确认 Bucket `vibe-music-data` 已创建

### 2. 前端启动失败

**问题**: 依赖安装失败
```bash
# 清除缓存后重新安装
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

**问题**: 端口被占用
- 修改 `vite.config.ts` 中的端口配置
- 或使用环境变量 `VITE_PORT` 指定端口

**问题**: 接口请求失败（CORS 错误）
- 检查后端服务是否正常启动
- 检查前端配置的后端地址是否正确
- 检查后端是否配置了 CORS 允许前端域名

### 3. 数据库相关问题

**问题**: 表不存在
- 确认已执行 `vibe_music.sql` 脚本
- 检查数据库名称是否正确

**问题**: 字符编码问题
- 确认数据库字符集为 `utf8mb4`
- 确认表字符集为 `utf8mb4_unicode_ci`

### 4. MinIO 相关问题

**问题**: 文件上传失败
- 检查 MinIO 服务是否运行
- 检查 Bucket 是否存在
- 检查 Bucket 访问策略是否正确
- 检查 MinIO 配置的 AccessKey 和 SecretKey

---

## 八、生产环境部署

### 1. 后端部署

```bash
# 编译生产版本
cd vibe-music-server
mvn clean package -DskipTests -Pprod

# 使用生产环境配置
java -jar -Dspring.profiles.active=prod target/vibe-music-server-0.0.1-SNAPSHOT.jar
```

### 2. 前端部署

```bash
# 客户端构建
cd vibe-music-client
pnpm run build
# 构建产物在 dist 目录

# 管理端构建
cd vibe-music-admin
pnpm run build
# 构建产物在 dist 目录
```

将构建产物部署到 Nginx 或其他 Web 服务器。

### 3. 环境变量配置

生产环境建议使用环境变量或配置文件管理敏感信息，不要将密码等硬编码在代码中。

---

## 九、项目结构说明

```
MusicPlayer/
├── vibe-music-server/          # 后端服务
│   ├── src/
│   │   └── main/
│   │       ├── java/          # Java 源代码
│   │       └── resources/
│   │           └── application.yml  # 配置文件
│   ├── sql/                   # SQL 脚本
│   └── pom.xml               # Maven 配置
├── vibe-music-client/         # 前端客户端（用户端）
│   ├── src/                   # 源代码
│   ├── vite.config.ts        # Vite 配置
│   └── package.json          # 依赖配置
├── vibe-music-admin/          # 前端管理端（管理后台）
│   ├── src/                   # 源代码
│   ├── vite.config.ts        # Vite 配置
│   └── package.json          # 依赖配置
└── README.md                  # 项目说明
```

---

## 十、技术支持

如果遇到问题，可以：

1. 查看项目文档和 README
2. 检查 Issues 中是否有类似问题
3. 提交新的 Issue 描述问题
4. 联系项目维护者

---

**最后更新**: 2025年1月  
**维护者**: 项目开发团队

