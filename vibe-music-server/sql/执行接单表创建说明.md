# 接单表创建说明

## 迁移内容
创建论坛接单表 `tb_forum_order`，用于记录需求帖子的接单信息。

## 执行方式

### 方式一：使用 PowerShell 脚本（推荐）

1. **打开 PowerShell**
   - 按 `Win + X`，选择 "Windows PowerShell" 或 "终端"
   - 或者按 `Win + R`，输入 `powershell`，按回车

2. **导航到 SQL 目录**
   ```powershell
   cd D:\15591\Desktop\MusicPlayer\vibe-music-server\sql
   ```

3. **执行迁移脚本**
   ```powershell
   .\execute-forum-order-migration.ps1
   ```

4. **如果需要自定义参数**（数据库名、用户名、密码等）
   ```powershell
   .\execute-forum-order-migration.ps1 -Username "root" -Password "你的密码" -Database "vibe_music"
   ```

5. **如果 MySQL 不在 PATH 中**
   ```powershell
   .\execute-forum-order-migration.ps1 -MysqlPath "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe"
   ```

### 方式二：使用 MySQL 命令行

1. **打开命令提示符或 PowerShell**

2. **导航到 SQL 文件所在目录**
   ```powershell
   cd D:\15591\Desktop\MusicPlayer\vibe-music-server\sql
   ```

3. **执行 MySQL 命令**
   ```bash
   mysql -u root -p3127 vibe_music < create_forum_order_table.sql
   ```
   
   或者交互式输入密码：
   ```bash
   mysql -u root -p vibe_music < create_forum_order_table.sql
   ```

4. **如果 MySQL 不在 PATH 中，使用完整路径**
   ```bash
   "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe" -u root -p3127 vibe_music < create_forum_order_table.sql
   ```

### 方式三：使用 MySQL Workbench 或其他数据库工具

1. **打开 MySQL Workbench** 或其他数据库管理工具（如 Navicat、DBeaver 等）

2. **连接到数据库**
   - 主机：localhost
   - 端口：3306
   - 用户名：root
   - 密码：3127（根据你的实际配置）
   - 数据库：vibe_music

3. **打开 SQL 文件**
   - 在工具中打开 `create_forum_order_table.sql` 文件
   - 或者直接复制 SQL 内容到查询窗口

4. **执行 SQL**
   - 点击"执行"按钮或按 `F5` 键

### 方式四：直接在 MySQL 命令行中执行

1. **登录 MySQL**
   ```bash
   mysql -u root -p3127
   ```

2. **选择数据库**
   ```sql
   USE vibe_music;
   ```

3. **执行 SQL 内容**
   ```sql
   CREATE TABLE IF NOT EXISTS `tb_forum_order` (
     `id` bigint NOT NULL AUTO_INCREMENT COMMENT '接单ID',
     `post_id` bigint NOT NULL COMMENT '帖子ID',
     `poster_id` bigint NOT NULL COMMENT '需求发布者ID',
     `accepter_id` bigint NOT NULL COMMENT '接单者ID',
     `status` tinyint NOT NULL DEFAULT 0 COMMENT '状态：0-待同意，1-已接单未完成，2-已完成',
     `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
     `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
     PRIMARY KEY (`id`),
     KEY `idx_post_id` (`post_id`),
     KEY `idx_poster_id` (`poster_id`),
     KEY `idx_accepter_id` (`accepter_id`),
     KEY `idx_status` (`status`),
     UNIQUE KEY `uk_post_accepter` (`post_id`, `accepter_id`) COMMENT '同一帖子同一用户只能接单一次'
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='论坛接单表';
   ```

## 验证表是否创建成功

执行以下 SQL 查询：

```sql
-- 查看表是否存在
SHOW TABLES LIKE 'tb_forum_order';

-- 查看表结构
DESCRIBE tb_forum_order;

-- 或者
SHOW CREATE TABLE tb_forum_order;
```

## 注意事项

- 执行前请确保 MySQL 服务已启动
- 确保数据库 `vibe_music` 已存在
- 如果表已存在，`CREATE TABLE IF NOT EXISTS` 不会报错，但也不会修改现有表结构
- 如果表已存在且结构不同，需要先删除表再执行：`DROP TABLE IF EXISTS tb_forum_order;`

